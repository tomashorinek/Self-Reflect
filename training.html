<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>Self-Coaching Plan Generator</title>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <style>
        body { font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; background: linear-gradient(to bottom right, #0d0d0d, #1a1a1a); color: white; margin: 0; padding: 2rem; }
        h1, h2 { text-align: center; }
        form { max-width: 600px; margin: auto; background: #1f1f1f; padding: 2rem; border-radius: 12px; }
        label, select, input, textarea, button { display: block; width: 100%; margin-top: 1rem; }
        select, input, textarea { padding: 0.5rem; background: #2b2b2b; color: white; border: 1px solid #444; border-radius: 6px; }
        input::placeholder, textarea::placeholder { color: #888; }
        button { background: #ff6600; color: white; font-weight: bold; padding: 1rem; border: none; border-radius: 6px; cursor: pointer; }
        button:disabled { opacity: 0.5; cursor: not-allowed; }
        .output { max-width: 800px; margin: 2rem auto; background: #1a1a1a; padding: 2rem; border-radius: 12px; }
        #trainingPlanContent { width: 100%; background: #2b2b2b; color: white; border: 1px solid #444; border-radius: 6px; padding: 0.5rem; box-sizing: border-box; margin-bottom: 1rem; min-height: 200px; white-space: pre-wrap; }
        .day { background: #1e1e1e; padding: 1rem; margin-bottom: 1rem; border-radius: 8px; }
        .exercise { display: flex; justify-content: space-between; background: #2a2a2a; padding: 0.5rem 1rem; margin: 0.5rem 0; border-radius: 6px; }
        .alt-list { color: #ccc; font-size: 0.9rem; }
        .alt-button { color: #ff9900; cursor: pointer; }
        #statusMessage { text-align: center; margin-top: 1rem; font-weight: bold; }
    </style>
</head>
<body>
    <h1>Self-Coaching Plan Generator</h1>
    <form id="trackerForm">
        <label for="goal">What's your main goal?</label><select id="goal"><option value="Build muscle">Build muscle</option><option value="Lose fat">Lose fat</option><option value="Get stronger">Get stronger</option><option value="Improve conditioning">Improve conditioning</option></select>
        <label for="frequency">How many days per week can you train?</label><select id="frequency" required><option value="">-- Select --</option><option value="1-2">1–2</option><option value="3-4">3–4</option><option value="5">5</option><option value="5plus">5+</option></select>
        <label for="equipment">Select Equipment Access:</label><select id="equipment" name="equipment"><option value="gym">Gym Access</option><option value="home">Home Training</option></select>
        <label for="experience">Your training experience level?</label><select id="experience"><option value="Beginner (0–3 months)">Beginner (0–3 months)</option><option value="Intermediate (3 months – 1 year)">Intermediate (3 months – 1 year)</option><option value="Advanced (1–2 years)">Advanced (1–2 years)</option><option value="Advanced+ (2+ years)">Advanced+ (2+ years)</option></select>
        <label for="injuries">Any injuries or health issues?</label><textarea id="injuries" placeholder="If yes, specify..."></textarea>
        <label for="fixed">Do you want a fixed weekly routine?</label><select id="fixed"><option value="Yes">Yes</option><option value="No">No</option></select>
        <label for="email">Where should we send your plan?</label><input type="email" id="email" placeholder="e.g. you@selftracker.com" required />
        <label for="gymName">What gym do you primarily train at?</label><input type="text" id="gymName" placeholder="e.g. Fitness Center Relax" required />
        <button type="submit">Generate My Plan</button>
    </form>

    <div class="output" id="outputBox" style="display:none">
        <h2>Your Training Plan</h2>
        <textarea id="trainingPlanContent" rows="20" cols="80"></textarea>
        <div id="training-container"></div>
        <button id="exportPlanBtn" style="background-color: orange; color: white; font-weight: bold; padding: 1em 2em; border: none; border-radius: 8px; cursor: pointer; width: 100%;">Continue with this plan</button>
        <div id="statusMessage"></div>
    </div>

    <script type="module" src="planLogic.js?v=100"></script>

    <script>
        // Definice proměnných zůstává
        const exportPlanBtn = document.getElementById('exportPlanBtn');
        const trainingPlanContentElement = document.getElementById('trainingPlanContent');
        const trainingContainer = document.getElementById('training-container');
        const outputBox = document.getElementById('outputBox');
        const trackerForm = document.getElementById('trackerForm');
        const statusMessage = document.getElementById('statusMessage');
        const gymNameInput = document.getElementById('gymName');

        // Vaše pomocná funkce pro vyplnění textarea zůstává
        function populateTrainingPlanTextarea() {
            let fullPlanText = "Your Training Plan:\n\n";
            const dayBlocks = trainingContainer.querySelectorAll('.day');
            if (dayBlocks.length === 0) {
                fullPlanText += "No training plan generated yet.";
            } else {
                dayBlocks.forEach(dayBlock => {
                    const dayTitle = dayBlock.querySelector('h3');
                    if (dayTitle) { fullPlanText += dayTitle.innerText.trim() + "\n"; }
                    const exerciseListContainer = dayBlock.querySelector('.exercise-list');
                    if (exerciseListContainer) {
                        const exerciseBlocks = exerciseListContainer.querySelectorAll('.exercise');
                        exerciseBlocks.forEach(exerciseBlock => {
                            const mainExerciseDiv = exerciseBlock.querySelector('div:first-child');
                            if (mainExerciseDiv) {
                                const tempDiv = document.createElement('div');
                                tempDiv.innerHTML = mainExerciseDiv.innerHTML;
                                const altListSpan = tempDiv.querySelector('.alt-list');
                                if (altListSpan) { altListSpan.remove(); }
                                fullPlanText += "- " + tempDiv.innerText.trim() + "\n";
                            }
                        });
                    }
                    fullPlanText += "\n";
                });
            }
            trainingPlanContentElement.value = fullPlanText;
            outputBox.style.display = 'block';
        }

        // Váš posluchač pro generování plánu zůstává
        trackerForm.addEventListener('submit', async (event) => {
            event.preventDefault();
            statusMessage.textContent = 'Generating your plan...';
            statusMessage.style.color = 'yellow';
            if (trainingContainer.innerText.trim() === '') {
                // Vaše simulační logika zde zůstává
                trainingContainer.innerHTML = `... VÁŠ DLOUHÝ KÓD PRO SIMULACI ...`;
            }
            setTimeout(() => {
                populateTrainingPlanTextarea();
                statusMessage.textContent = 'Plan generated. You can now continue!';
                statusMessage.style.color = 'green';
            }, 500);
        });

        // --- ZDE JE TA KLÍČOVÁ ZMĚNA ---
        // Tento posluchač je nahrazený za funkční verzi s voláním na Cloudflare
        const apiUrl = 'https://api.webbyfe.com/'; // Vaše API adresa

        exportPlanBtn.addEventListener('click', async () => {
            const planText = trainingPlanContentElement.value.trim();
            const gymName = gymNameInput.value.trim();

            if (!planText || !gymName) {
                alert('Please generate a plan and enter a gym name first.');
                return;
            }

            statusMessage.textContent = 'Creating your logbook... Please wait.';
            statusMessage.style.color = 'yellow';
            exportPlanBtn.disabled = true;

            try {
                const response = await fetch(apiUrl, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ plan: planText, gymName: gymName })
                });

                const result = await response.json();

                if (result.status === 'success') {
                    statusMessage.textContent = 'Success! Opening your logbook in a new tab...';
                    statusMessage.style.color = 'green';
                    window.open(result.sheetUrl, '_blank');
                } else {
                    throw new Error(result.message);
                }

            } catch (error) {
                console.error('Error:', error);
                statusMessage.textContent = 'Error creating logbook: ' + error.message;
                statusMessage.style.color = 'red';
            } finally {
                exportPlanBtn.disabled = false;
            }
        });

        window.populateTrainingPlanTextarea = populateTrainingPlanTextarea;
    </script>
</body>
</html>
